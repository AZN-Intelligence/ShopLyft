# ShopLyft Browser Extension

A Chrome browser extension that automates adding grocery products to shopping carts from optimized shopping plans generated by the ShopLyft web application.

## üìÅ File Structure

```
extension/
‚îú‚îÄ‚îÄ manifest.json           # Extension configuration and permissions
‚îú‚îÄ‚îÄ content.js             # Content script for ShopLyft web app integration
‚îú‚îÄ‚îÄ background.js          # Background service worker for tab management
‚îú‚îÄ‚îÄ popup.html             # Extension popup interface
‚îú‚îÄ‚îÄ popup.js              # Popup functionality and manual link input
‚îú‚îÄ‚îÄ inject-add-to-cart.js  # Injected script for automated cart additions
‚îú‚îÄ‚îÄ shoplyfter-jump.png    # Extension mascot image for notifications
‚îî‚îÄ‚îÄ README.md             # This documentation
```

## üöÄ Features

### 1. **Automated Cart Addition**

- Automatically adds multiple grocery products to cart across different retailer websites
- Supports major Australian grocery retailers (Woolworths, Coles, ALDI)
- Opens product pages in background tabs and adds items without user interaction

### 2. **ShopLyft Integration**

- Seamlessly integrates with the ShopLyft web application
- Listens for `shoplyft-add-to-cart` events from the frontend
- Processes optimized shopping plans with "Add All to Cart" functionality

### 3. **Visual Notifications**

- Beautiful slide-out notifications with ShopLyfter mascot
- Animated notifications confirm successful cart additions
- Fallback system notifications for reliability

### 4. **Manual Operation**

- Extension popup allows manual entry of product links
- Supports batch processing of multiple product URLs
- Cross-browser compatibility (Chrome/Firefox)

### 5. **Intelligent Site Detection**

- Automatically detects different retailer websites
- Uses site-specific selectors for cart buttons
- Handles shadow DOM elements (Woolworths web components)
- Waits for dynamic content loading before interaction

## üîß Technical Implementation

### Content Script (`content.js`)

- **Purpose**: Bridges ShopLyft web app and extension background
- **Features**:
  - Listens for custom DOM events from the frontend
  - Displays animated slide-out notifications
  - Relays cart addition requests to background script
  - Provides debugging functions for development

### Background Service Worker (`background.js`)

- **Purpose**: Manages tab creation and script injection
- **Features**:
  - Creates background tabs for each product link
  - Injects cart addition scripts when pages load
  - Coordinates completion notifications
  - Handles tab lifecycle management

### Injection Script (`inject-add-to-cart.js`)

- **Purpose**: Performs actual cart additions on retailer sites
- **Features**:
  - Site-specific button selectors for different retailers
  - Shadow DOM support for modern web components
  - Mutation observer for dynamically loaded content
  - Robust error handling and logging

### Popup Interface (`popup.html` + `popup.js`)

- **Purpose**: Manual operation interface
- **Features**:
  - Simple textarea for pasting multiple product links
  - One-click batch processing
  - Cross-browser API compatibility
  - Input validation and error handling

## üõ† Installation & Setup

### 1. **Load Extension in Chrome**

```bash
1. Open Chrome and navigate to chrome://extensions/
2. Enable "Developer mode" in the top right
3. Click "Load unpacked" and select the extension/ folder
4. The ShopLyft extension should appear in your extensions list
```

### 2. **Permissions Required**

- **Scripting**: Inject cart addition scripts into retailer websites
- **Tabs**: Create and manage background tabs for automation
- **Notifications**: Show system notifications for completion status
- **Host Permissions**: Access all websites for retailer compatibility

### 3. **Usage with ShopLyft Web App**

```bash
1. Visit the ShopLyft web application
2. Create an optimized shopping plan
3. Click "Add All to Cart" in the plan header
4. Extension automatically processes all product links
5. Receive notification when all items are added
```

### 4. **Manual Usage**

```bash
1. Click the ShopLyft extension icon in Chrome toolbar
2. Paste product URLs (one per line) in the textarea
3. Click "Add All to Cart"
4. Extension opens tabs and adds items automatically
```

## üéØ Supported Retailers

### Woolworths

- **Selector**: `wc-add-to-cart` shadow DOM component
- **Button**: `.add-to-cart-btn` within shadow root
- **Features**: Handles modern web components and shadow DOM

### Coles

- **Selector**: `[data-testid="add-to-cart-button"]`
- **Features**: Uses data attributes for reliable selection

### ALDI (Future Support)

- **Status**: Prepared for implementation
- **Note**: Selectors can be added as needed

## üîç Development & Debugging

### Console Logging

All extension components include comprehensive logging:

```javascript
// Enable debug mode by checking browser console
// Look for "[ShopLyft Extension]" prefixed messages
```

### Testing Functions

```javascript
// Test notifications manually in browser console
window.testNotification();
```

### Event Communication

```javascript
// Frontend dispatches events that extension listens for
window.dispatchEvent(
  new CustomEvent("shoplyft-add-to-cart", {
    detail: { links: ["url1", "url2", "url3"] },
  })
);
```

## üõ° Security & Privacy

- **Minimal Permissions**: Only requests necessary permissions for functionality
- **No Data Collection**: Extension doesn't collect or store user data
- **Local Processing**: All operations happen locally in the browser
- **Secure Communication**: Uses Chrome's secure messaging APIs

## üîÑ Extension Lifecycle

1. **Initialization**: Content script loads on ShopLyft pages
2. **Event Listening**: Waits for cart addition requests
3. **Tab Management**: Creates background tabs for each product
4. **Script Injection**: Injects automation scripts when pages load
5. **Completion Tracking**: Monitors progress and shows notifications
6. **Cleanup**: Automatically manages tab lifecycle and memory

## üìù Configuration

### Manifest Version 3

- Uses modern Chrome extension architecture
- Service worker background script for better performance
- Declarative content script injection

### Host Permissions

```json
{
  "host_permissions": ["<all_urls>"],
  "content_scripts": [
    {
      "matches": [
        "http://localhost/*",
        "https://localhost:5173/*",
        "https://shoplyft.com/*",
        "<all_urls>"
      ]
    }
  ]
}
```

## üö® Troubleshooting

### Common Issues

1. **Extension not working**: Check if developer mode is enabled
2. **No notifications**: Verify notification permissions in Chrome settings
3. **Cart not updating**: Check retailer website changes (selectors may need updates)
4. **Background tabs not closing**: Extension handles cleanup automatically

### Debug Steps

1. Open Chrome DevTools console
2. Look for ShopLyft extension log messages
3. Check extension popup for error messages
4. Verify product URLs are valid and accessible

## üîÆ Future Enhancements

- **More Retailers**: Add support for additional grocery chains
- **Smart Retry**: Automatic retry for failed cart additions
- **Quantity Management**: Support for specific product quantities
- **Price Tracking**: Integration with price comparison features
- **User Preferences**: Customizable notification settings
